# # Fast check de la Fase 2 del workflow - flujo-app.md 
# ## Resumen (usar siempre el LLM real: http://100.105.212.98:8317/)
@baseUrl = http://localhost:8080
@llmEndpoint = http://100.105.212.98:8317/
@devUserId = 000000000000000000000001

# ⚠️ IMPORTANTE: Reemplaza estos IDs con los valores reales de las respuestas
@ideaId = 693af3de728db46d5cf09405
@draftId = unknown
@topicId = unknown
@promptId = unk
@jobId = 19fc725c-4ec9-44f7-b01a-36d9eb47d9e3

# ### App(config)
# - user (hardcoded)
# - idioma: *por implementar, (hardcoded -> es) idioma que se utiliza para generar las ideas*
GET {{baseUrl}}/health HTTP/1.1
Content-Type: application/json

### Ejemplo real (2025-12-10 13:03Z)
# {
#   "status": "healthy",
#   "timestamp": "2025-12-10T13:03:48.927Z",
#   "components": {
#     "database": "healthy",
#     "nats": "connected",
#     "workers": {
#       "draft_generation": {
#         "status": "running",
#         "started_at": "2025-12-10T12:58:06.120Z"
#       }
#     }
#   }
# }

# ### Prompt (Fase 2 - Sistema de Prompts con Variables)
# - [x] al iniciar la app se carga prompts desde seed/prompt/
# - [x] El usuario puede modificar los prompts con variables dinámicas
# - [x] Los prompts usan variables como {name}, {[keywords]}, {user_context}, etc.
### Obtener Todos los Prompts del Usuario
GET {{baseUrl}}/v1/prompts/{{devUserId}} HTTP/1.1
Content-Type: application/json
### Ejemplo real (con nuevo sistema de prompts y variables)
# {
#   "count": 3,
#   "prompts": [
#     {
#       "id": "6935bbc043319a458b38abc8",
#       "name": "base1",
#       "type": "ideas",
#       "prompt_template": "Generate {ideas} ideas about {name} with keywords: {[keywords]}",
#       "user_id": "{{devUserId}}",
#       "active": true
#     },
#     {
#       "id": "6935bbc043319a458b38abc9",
#       "name": "professional",
#       "type": "drafts",
#       "prompt_template": "Create professional content based on:\nContent: {content}\nTopic: {topic_name}\nUser Context: {user_context}",
#       "user_id": "{{devUserId}}",
#       "active": true
#     },
#     {
#       "id": "6935bbc043319a458b38abc0",
#       "name": "creative",
#       "type": "ideas",
#       "prompt_template": "Generate innovative {ideas} ideas about {name} in category {category}. Focus on: {[related_topics]}",
#       "user_id": "{{devUserId}}",
#       "active": true
#     }
#   ]
# }
# ### Topics (Fase 2 - Con Soporte de Prompts)
# - [x] al iniciar la app se cargan topics desde seed/topic.json con referencias a prompts
# - [x] los topics usan el campo 'prompt' (cambiado de 'prompt_name') para referenciar prompts específicos
# - [x] el usuario puede introducir, modificar y eliminar topics con sus referencias de prompt

# *Variables soportadas en prompts de ideas:*
# - {name}: topic.name
# - {ideas}: topic.ideas_count (nuevo campo)
# - {[keywords]}: topic.keywords (array a texto separado por comas)
# - {category}: topic.category
# - {priority}: topic.priority (1-10)
# - {[related_topics]}: topic.related_topics (array a texto)

# - name: nombre descriptivo único, usado por la IA y usuario
# - description: para el usuario
# - prompt: **(NUEVO)** referencia al prompt usado para generar ideas (ej: "base1")
# - category: categoría/clasificación (default "General")
# - priority: importancia al crear ideas (1-10, default 5)
# - ideas_count: **(NUEVO)** cantidad de ideas a generar (default 2)
# - keywords: **(NUEVO)** array de términos para la variable {[keywords]}
# - related_topics: array de nombres de otros topics para variable {[related_topics]}
GET {{baseUrl}}/v1/topics/{{devUserId}} HTTP/1.1
Content-Type: application/json
### Ejemplo real (con nuevo sistema de prompts y variables)
# {
#   "count": 4,
#   "topics": [
#     { 
#       "id": "6935bbc043319a458b38abcb", 
#       "user_id": "{{devUserId}}",
#       "name": "Desarrollo Backend",
#       "description": "Creación de APIs y microservicios",
#       "prompt": "base1",
#       "category": "Backend",
#       "priority": 8,
#       "ideas_count": 5,
#       "keywords": ["microservicios", "apis", "mongodb", "rest", "graphql"],
#       "related_topics": ["Docker", "Kubernetes", "Go"],
#       "active": true,
#       "created_at": "2025-12-10T12:00:00Z"
#     },
#     { 
#       "id": "6935bbc043319a458b38abca", 
#       "user_id": "{{devUserId}}",
#       "name": "Inteligencia Artificial",
#       "description": "Machine Learning y deep learning",
#       "prompt": "creative",
#       "category": "AI/ML",
#       "priority": 9,
#       "ideas_count": 7,
#       "keywords": ["machinelearning", "deeplearning", "neuralnetworks", "python"],
#       "related_topics": ["Python", "Data Science", "TensorFlow"],
#       "active": true,
#       "created_at": "2025-12-10T12:00:00Z"
#     },
#     { 
#       "id": "6935bbc043319a458b38abcc", 
#       "user_id": "{{devUserId}}",
#       "name": "TypeScript",
#       "description": "Tipado estático en JavaScript",
#       "prompt": "base1",
#       "category": "Frontend",
#       "priority": 7,
#       "ideas_count": 3,
#       "keywords": ["typescript", "javascript", "nodejs", "react"],
#       "related_topics": ["JavaScript ES6", "Node.js", "React"],
#       "active": true,
#       "created_at": "2025-12-10T12:00:00Z"
#     },
#     { 
#       "id": "6935d512c95d0eae4a13975e", 
#       "user_id": "{{devUserId}}",
#       "name": "DevOps y Cloud",
#       "description": "Contenerización y orquestación",
#       "prompt": "professional",
#       "category": "DevOps",
#       "priority": 8,
#       "ideas_count": 4,
#       "keywords": ["docker", "kubernetes", "aws", "cicd"],
#       "related_topics": ["Docker", "Kubernetes", "AWS"],
#       "active": true,
#       "created_at": "2025-12-10T12:00:00Z"
#     }
#   ]
# }

# ### Ideas
# - [ ] se generan tantas ideas como este indicado para cada topic
#   - [x] al iniciar la app se crean ideas usando los prompts referenciados por topic
#   - [x] cada vez que el usuario introduce/modifica topic, se genera ideas con su prompt específico
#   - [x] [NUEVO] las ideas tienen validación de longitud 10-200 caracteres (cambiado de 10-5000)

# *Ejemplos de ideas generadas con variables:*
# *Topic "TypeScript" con prompt "base1" -> "5 tips avanzados para TypeScript con generics y decorators"*

### Obtener Todas las Ideas del Usuario
GET {{baseUrl}}/v1/ideas/{{devUserId}} HTTP/1.1
Content-Type: application/json
### Ejemplo real (primeras 3 ideas)
# {
#   "count": 25,
#   "ideas": [
#     {
#       "id": "6935d53ac95d0eae4a13975f",
#       "content": "Patrones avanzados con tipos condicionales...",
#       "topic_id": "6935bbc043319a458b38abcc",
#       "topic_name": "TypeScript",
#       "used": false
#     },
#     {
#       "id": "6935d53ac95d0eae4a139760",
#       "content": "Migración de JavaScript a TypeScript en monorepos sin frenar releases",
#       "topic_id": "6935bbc043319a458b38abcc",
#       "topic_name": "TypeScript",
#       "used": false
#     },
#     {
#       "id": "6935d53ac95d0eae4a139761",
#       "content": "Domina el operador 'satisfies'...",
#       "topic_id": "6935bbc043319a458b38abcc",
#       "topic_name": "TypeScript",
#       "used": false
#     }
#   ]
# }

### Generar Draft desde una Idea (Asíncrono - retorna job ID)
# NOTA: Esto genera automáticamente 5 posts + 1 artículo EXCLUSIVAMENTE a partir del endpoint {{llmEndpoint}}
# El proceso es asíncrono y usa un worker con NATS, no existen mocks en esta fase
POST {{baseUrl}}/v1/drafts/generate HTTP/1.1
Content-Type: application/json

{
  "user_id": "{{devUserId}}",
  "idea_id": "{{ideaId}}"
}

### Ejemplo real
# 202 Accepted
# {
#   "message": "Draft generation started",
#   "job_id": "825372af-f822-417e-a87b-d2bec8110872"
# }

###
### Paso 6c: NUEVO - Consultar Estado del Job
# @name getJobStatus
# ⚠️ REQUERIDO: Copia el job_id de la respuesta del Paso 6 y reemplázalo arriba en @jobId
# Este endpoint muestra el estado actual del job: pending, processing, completed, failed
# También devuelve los draft_ids generados cuando el job está completado
#
# Ejemplo de respuesta cuando está en proceso:
# {
#   "job_id": "550e8400-e29b-41d4-a716-446655440000",
#   "status": "processing",
#   "idea_id": "507f1f77bcf86cd799439011",
#   "created_at": "2025-12-07T10:30:00Z",
#   "started_at": "2025-12-07T10:30:01Z"
# }
#
# Ejemplo de respuesta cuando está completado:
# {
#   "job_id": "550e8400-e29b-41d4-a716-446655440000",
#   "status": "completed",
#   "idea_id": "507f1f77bcf86cd799439011",
#   "draft_ids": ["507f...", "507f...", "507f...", "507f...", "507f...", "507f..."],
#   "created_at": "2025-12-07T10:30:00Z",
#   "started_at": "2025-12-07T10:30:01Z",
#   "completed_at": "2025-12-07T10:30:15Z"
# }
GET {{baseUrl}}/v1/drafts/jobs/{{jobId}} HTTP/1.1
Content-Type: application/json
### Ejemplo real (completed)
# {
#   "job_id": "825372af-f822-417e-a87b-d2bec8110872",
#   "status": "completed",
#   "idea_id": "6935d53ac95d0eae4a139760",
#   "draft_ids": [
#     "69396f923587f862431eeef1",
#     "69396f923587f862431eeef2",
#     "69396f923587f862431eeef3",
#     "69396f923587f862431eeef4",
#     "69396f923587f862431eeef5",
#     "69396f923587f862431eeef6"
#   ],
#   "created_at": "2025-12-10T13:02:29Z",
#   "started_at": "2025-12-10T13:02:29Z",
#   "completed_at": "2025-12-10T13:03:14Z"
# }
###
### Paso 7: Esperar unos segundos y Ver Drafts Generados
# @name getDrafts
# El worker puede tardar 5-10 segundos en procesar la solicitud
# Primero verifica el estado del job en el Paso 6c
# Cuando el job esté en "completed", ejecuta este endpoint
# Deberías ver 6 drafts (5 posts + 1 artículo) GENERADOS CON EL LLM LOCAL {{llmEndpoint}}
GET {{baseUrl}}/v1/drafts/{{devUserId}}?status=DRAFT HTTP/1.1
Content-Type: application/json
### Ejemplo real (limit=6)
# {
#   "count": 6,
#   "drafts": [
#     {
#       "id": "69396f923587f862431eeef1",
#       "type": "POST",
#       "content": "¿Migrar a TypeScript en un monorepo sin congelar releases?..."
#     },
#     {
#       "id": "69396f923587f862431eeef2",
#       "type": "POST",
#       "content": "El mayor error al migrar a TypeScript en monorepos es empezar por la app..."
#     },
#     {
#       "id": "69396f923587f862431eeef3",
#       "type": "POST",
#       "content": "La migración a TypeScript no es solo técnica..."
#     },
#     {
#       "id": "69396f923587f862431eeef4",
#       "type": "POST",
#       "content": "Rendimiento del compilador no siempre iguala productividad..."
#     },
#     {
#       "id": "69396f923587f862431eeef5",
#       "type": "POST",
#       "content": "Tu pipeline define el éxito de la migración más que el código..."
#     },
#     {
#       "id": "69396f923587f862431eeef6",
#       "type": "ARTICLE",
#       "title": "Guía práctica: migrar de JavaScript a TypeScript en monorepos sin frenar releases"
#     }
#   ]
# }

### Paso 7d: Diagnóstico rápido de fallos
# Si el job pasa a FAILED revisa la colección jobErrors en Mongo (requiere CLI):
# mongo "mongodb://localhost:27017/linkgenai" --quiet --eval 'db.jobErrors.find({job_id: "{{jobId}}"}).sort({created_at:-1}).limit(1)' | jq


# ### Draft (Fase 2 - Sistema con Prompts Dinámicos)
# Variables soportadas en prompts de draft:
# - {content}: idea.content (idea original)
# - {topic_name}: idea.topic_name (nombre del topic relacionado)
# - {user_context}: contexto del usuario construido desde su configuración

# - [x] El usuario ejecuta esta función y el sistema usa prompts activos de tipo 'drafts'
# - [x] El contexto del usuario se incluye automáticamente en {user_context}
# - [x] Se genera contenido personalizado:
#   - [x] 5 posts para LinkedIn (120-260 palabras cada uno)
#   - [x] 1 artículo extenso (con título)

# Ejemplo de {user_context} generado:
# Name: Juan García
# Expertise: Desarrollo Backend  
# Tone: Profesional 
